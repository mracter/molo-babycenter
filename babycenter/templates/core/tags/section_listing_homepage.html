{% load wagtailcore_tags wagtailimages_tags core_tags i18n %}

{% if sections %}
{% for section in sections %}
{% load_descendant_articles_for_section section featured_in_homepage=True as articles %}
<div class="section-list section-list{{section.get_effective_extra_style_hints}}">
	{% if articles %}
	<h2 class="section__title">
		<a href="{% pageurl section %}">{{section.title}}</a>
	</h2>
	<ul class="article-list">
		{% for article in articles %}
			{% if article.get_parent_section = section %}
			<li class="article-list__item">
				<a href="{% pageurl article %}">
				{% if article.image %}
				{% image article.image  width-45 class="article-list__image" %}
				{% endif %}
				<h4 class="article-list__title">{{ article.title }}</h4>
				<span class="article-list__subtitle">{{ article.subtitle }}</span>
				</a>
			</li>
			{% endif %}
		{% endfor%}
	</ul>


	{% load_child_sections_for_section section as sub_sections %}
	{% if sub_sections %}
	{% for sub_section in sub_sections %}
		{% load_descendant_articles_for_section sub_section featured_in_homepage=True as featured_articles %}
			{% if featured_articles %}
					<h3 class="section__title section__title--subsection">
						<a href="{% pageurl sub_section %}">{{sub_section.title}}</a>
					</h3>
			
					<ul class="article-list">
						{% for featured_article in featured_articles %}
						<li class="article-list__item">
							<a href="{% pageurl featured_article %}">
								{% if featured_article.image %}
									{% image featured_article.image  width-45 class="article-list__image" %}
								{% endif %}
								<h4 class="article-list__title">{{ featured_article.title }}</h4>
									<span class="article-list__subtitle">{{ featured_article.subtitle }}</span>
							</a>
						</li>
						{% endfor %}
					</ul>
					<a href="{% pageurl sub_section %}" class="section-list__more section-list__more{{section.get_effective_extra_style_hints}}">
					{% trans "View More" %}</a>
			{% endif %}
	{% endfor %}
	{% endif %}

		<a href="{% pageurl section %}" class="section-list__more section-list__more-cat section-list__more-cat{{section.get_effective_extra_style_hints}}">
		{% trans "More about" %} {{section.title}}</a>
	{% endif %}
	</div>
{% endfor %}
{% endif %}

